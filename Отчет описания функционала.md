# Документация к функционалу работы с покупателями

## Связанные файлы

В данной части приложения для работы с покупателями используются следующие файлы:

1. **`customer_main.py`** — основной файл, который управляет взаимодействием пользователя с приложением, предоставляет меню и обрабатывает пользовательские команды.
  
2. **`customer_modules.py`** — файл, содержащий функции, связанные с управлением покупателями и регистрацией на спектакли. Эти функции выполняют основные операции, такие как просмотр спектаклей и регистрация покупателей.

## Функционал

### Основные функции, относящиеся к покупателям

1. **`view_events()`**

   - **Описание**: Эта функция отображает список доступных спектаклей, которые можно приобрести. 
   - **Функционал**: 
     - Подключается к базе данных.
     - Выполняет SQL-запрос для выборки спектаклей, у которых есть свободные места.
     - Если спектакли найдены, отображает их с деталями (ID, название, цена, дата, свободные места).
     - Позволяет пользователю выбрать спектакль по его ID для дальнейшей регистрации.
     - Если спектаклей нет, информирует пользователя и возвращает его в главное меню.

2. **`register_customer(event_id, event_name, event_price)`**

   - **Описание**: Эта функция отвечает за регистрацию покупателя и создание заказа на выбранный спектакль.
   - **Функционал**: 
     - Подключается к базе данных.
     - Сбор информации от пользователя: имя, возраст, электронная почта и телефон.
     - Вставка информации о покупателе в таблицу `customers`. Если покупатель уже существует (по уникальному полю email), то запись не создаётся, благодаря использованию `INSERT OR IGNORE`.
     - Получение ID покупателя из таблицы `customers`.
     - Создание записи в таблице `orders`, связывая покупателя с выбранным спектаклем.
     - Уменьшение количества доступных мест в спектакле на единицу.
     - Обработка ошибок и вывод сообщений о результате операции.

3. **`cancel_ticket()`**

   - **Описание**: Эта функция позволяет пользователю отменить ранее купленный билет.
   - **Функционал**:
     - Подключается к базе данных.
     - Запрашивает у пользователя номер заказа, который он хочет отменить.
     - Проверяет наличие заказа в таблице `orders` по введённому ID.
     - Если заказ найден, удаляет запись из таблицы `orders` и увеличивает количество свободных мест в соответствующем спектакле.
     - Обрабатывает ошибки, например, если заказ не найден, и возвращает пользователя в главное меню.

## Взаимосвязь функций

- **`view_events()`** инициирует процесс регистрации, передавая необходимые параметры в **`register_customer()`**, если пользователь выбрал спектакль.
- **`register_customer()`** управляет добавлением данных о покупателе и созданием заказа, обрабатывая возможные конфликты при регистрации (например, если покупатель уже зарегистрирован).
- **`cancel_ticket()`** обеспечивает возможность пользователям управлять своими заказами, что важно для удобства работы с приложением.

# Документация к функционалу работы с администратором

## Связанные файлы

В данной части приложения для работы с администратором используются следующие файлы:

1. **`admin_main.py`** — основной файл, который управляет взаимодействием администратора с приложением, предоставляет меню и обрабатывает команды.
  
2. **`admin_modules.py`** — файл, содержащий функции, связанные с управлением спектаклями, покупателями и отчетами. Эти функции выполняют основные операции, такие как добавление и удаление спектаклей, а также получение информации о покупателях и спектаклях.

## Функционал

### Основные функции, относящиеся к администратору

1. **`view_events()`**

   - **Описание**: Эта функция отображает список актуальных спектаклей в базе данных.
   - **Функционал**: 
     - Подключается к базе данных.
     - Выполняет SQL-запрос для выборки всех спектаклей.
     - Отображает информацию о каждом спектакле (ID, название, цена, дата, свободные места) для администратора.

2. **`add_event(name, price, date, free_slots)`**

   - **Описание**: Эта функция позволяет администратору добавлять новый спектакль в таблицу `events`.
   - **Функционал**:
     - Подключается к базе данных.
     - Вставляет новую запись со всеми необходимыми данными (название, цена, дата, количество свободных мест) в таблицу `events`.
     - Обрабатывает ошибки и выводит сообщение о результате операции.

3. **`delete_event(event_id)`**

   - **Описание**: Эта функция позволяет администратору удалять спектакль из таблицы `events`.
   - **Функционал**:
     - Подключается к базе данных.
     - Проверяет наличие спектакля с указанным ID.
     - Если спектакль существует, удаляет запись из таблицы `events`.
     - Обрабатывает ошибки, например, если спектакль не найден, и выводит соответствующее сообщение.

4. **`get_all_customers()`**

   - **Описание**: Эта функция выводит список всех покупателей, зарегистрированных в системе.
   - **Функционал**:
     - Подключается к базе данных.
     - Выполняет SQL-запрос для выборки всех записей из таблицы `customers`.
     - Отображает информацию о каждом покупателе (ID, имя, возраст, электронная почта, телефон).

5. **`get_customers_by_event(event_id)`**

   - **Описание**: Эта функция позволяет получить список покупателей, зарегистрированных на конкретный спектакль.
   - **Функционал**:
     - Подключается к базе данных.
     - Выполняет SQL-запрос для выборки покупателей, связанных с указанным спектаклем в таблице `orders`.
     - Отображает информацию о каждом покупателе, включая контактные данные.

6. **`get_customers_not_registered(event_id)`**

   - **Описание**: Эта функция возвращает список покупателей, не зарегистрированных на конкретный спектакль.
   - **Функционал**:
     - Подключается к базе данных.
     - Выполняет SQL-запрос для выборки покупателей, которые не связаны с указанным спектаклем.
     - Отображает информацию о каждом покупателе.

7. **`get_sales_ranking()`**

   - **Описание**: Эта функция возвращает ранжированный список спектаклей по количеству проданных билетов.
   - **Функционал**:
     - Подключается к базе данных.
     - Выполняет SQL-запрос для агрегации данных о заказах и подсчета количества билетов, проданных на каждый спектакль.
     - Отображает список спектаклей с указанием количества проданных билетов.

8. **`get_revenue_ranking()`**

   - **Описание**: Эта функция возвращает ранжированный список спектаклей по сумме, полученной от продаж билетов.
   - **Функционал**:
     - Подключается к базе данных.
     - Выполняет SQL-запрос для подсчета общей суммы, полученной от продаж билетов для каждого спектакля.
     - Отображает список спектаклей с указанием общей суммы дохода.

